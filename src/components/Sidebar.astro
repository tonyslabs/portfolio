---
const { selectedItem } = Astro.props;
---

<aside class="sidebar" id="sidebar">
  <div class="sidebar-inner">
    <!-- Perfil -->
    <a href="/" class="profile-link" aria-label="home">
      <div class="profile">
        <img src="/assets/image.png" alt="Profile picture" class="profile-image" />
        <div class="profile-info">
          <div class="profile-name">Tony Lacayo</div>
          <div class="profile-role">Web & API Developer</div>
        </div>
      </div>
    </a>

    <!-- Navegación -->
    <nav class="nav">
      <a href="/" class={`nav-item ${selectedItem === 'home' ? 'active' : ''}`} data-label="Home">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span class="nav-label">Home</span>
      </a>

      <a href="/web-development" class={`nav-item ${selectedItem === 'web-development' ? 'active' : ''}`} data-label="Web Development">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 8 12 12 15 15"></polyline>
        </svg>
        <span class="nav-label">Web Development</span>
      </a>

      <a href="/api-integrations" class={`nav-item ${selectedItem === 'api-integrations' ? 'active' : ''}`} data-label="API Integrations">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M16 4h2a2 2 0 0 1 2 2v2"></path>
          <path d="M8 20H6a2 2 0 0 1-2-2v-2"></path>
          <path d="M12 12h.01"></path>
          <path d="M12 8h.01"></path>
          <path d="M12 16h.01"></path>
        </svg>
        <span class="nav-label">API Integrations</span>
      </a>

      <a href="/infrastructure" class={`nav-item ${selectedItem === 'infrastructure' ? 'active' : ''}`} data-label="Infrastructure">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="3" y1="9" x2="21" y2="9"></line>
          <line x1="9" y1="21" x2="9" y2="9"></line>
        </svg>
        <span class="nav-label">Infrastructure</span>
      </a>

      <a href="/personal-projects" class={`nav-item ${selectedItem === 'personal-projects' ? 'active' : ''}`} data-label="Proyectos Personales">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.37 1.46 10.13 4.59 13.26L12 20.67l7.41-7.41C22.54 10.13 22.54 6.37 20.42 4.58z"></path>
        </svg>
        <span class="nav-label">Proyectos Personales</span>
      </a>
    </nav>
  </div>
</aside>

<script>
  document.addEventListener("astro:page-load", () => {
    const sidebar = document.getElementById("sidebar");
    if (!sidebar) return;

    let hoverTimeout;

    const expand = () => {
      clearTimeout(hoverTimeout);
      sidebar.classList.add("expanded");
    };

    const collapse = () => {
      hoverTimeout = setTimeout(() => {
        sidebar.classList.remove("expanded");
      }, 300);
    };

    sidebar.addEventListener("mouseenter", expand);
    sidebar.addEventListener("mouseleave", collapse);

    // Tooltip
    sidebar.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('mouseenter', () => {
        if (sidebar.classList.contains('expanded')) return;
        const label = item.dataset.label;
        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        tooltip.textContent = label;
        tooltip.style.cssText = `
          position: absolute;
          left: 78px;
          top: 50%;
          transform: translateY(-50%);
          background: #1a1a1f;
          color: #fff;
          padding: 6px 10px;
          border-radius: 6px;
          font-size: 0.8rem;
          font-weight: 500;
          white-space: nowrap;
          pointer-events: none;
          opacity: 0;
          transition: opacity 0.2s ease;
          z-index: 100;
          box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        `;
        item.style.position = 'relative';
        item.appendChild(tooltip);
        requestAnimationFrame(() => tooltip.style.opacity = '1');
      });

      item.addEventListener('mouseleave', () => {
        const tooltip = item.querySelector('.tooltip');
        if (tooltip) {
          tooltip.style.opacity = '0';
          setTimeout(() => tooltip.remove(), 200);
        }
      });
    });
  });
</script>

<style>
  :root {
    --bg: rgba(32, 32, 38, 0.95);
    --width-collapsed: 72px;
    --width-expanded: 260px;
    --icon-size: 26px;
  }

  .sidebar {
    position: fixed;
    top: 0; left: 0;
    height: 100vh;
    width: var(--width-collapsed);
    background: var(--bg);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-right: 1px solid rgba(255,255,255,0.07);
    transition: width 0.28s cubic-bezier(0.2, 0, 0, 1);
    overflow: hidden;
    z-index: 60;
    display: flex;
    flex-direction: column;
  }

  .sidebar.expanded { width: var(--width-expanded); }

  .sidebar-inner {
    padding: 1.5rem 0;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Perfil */
  .profile-link { display: flex; justify-content: center; margin-bottom: 2.5rem; }
  .profile { display: flex; align-items: center; gap: 0.75rem; }
  .profile-image {
    width: 42px; height: 42px;
    border-radius: 50%;
    border: 2px solid rgba(255,255,255,0.12);
    box-shadow: 0 2px 8px rgba(0,0,0,0.25);
    flex-shrink: 0;
  }
  .profile-info {
    opacity: 0; transform: translateX(-8px);
    transition: opacity 0.28s ease, transform 0.28s ease;
    white-space: nowrap; overflow: hidden;
  }
  .sidebar.expanded .profile-info { opacity: 1; transform: translateX(0); }
  .profile-name { color: #fff; font-weight: 600; font-size: 0.92rem; line-height: 1.3; }
  .profile-role { color: #b8b8c0; font-size: 0.76rem; line-height: 1.3; }

  /* Íconos */
  .nav-icon {
    width: var(--icon-size);
    height: var(--icon-size);
    color: #ffffff;
    flex-shrink: 0;
    display: block;
    transition: transform 0.2s ease;
  }

  /* Navegación */
  .nav {
    display: grid;
    grid-template-rows: repeat(5, 48px);
    gap: 12px;
    justify-content: center;
    width: 100%;
  }

  .sidebar:not(.expanded) .nav-item {
    width: 48px;
    height: 48px;
    margin: 0 auto;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .sidebar:not(.expanded) .nav-item {
    padding: 0;
  }

  .sidebar.expanded .nav-item {
    width: calc(100% - 24px);
    height: auto;
    justify-content: flex-start;
    padding: 0.65rem 0.75rem;
    margin: 0 12px;
  }

  .nav-item:hover { background: rgba(255,255,255,0.12); color: #fff; }
  .sidebar:not(.expanded) .nav-item:hover { 
    background: rgba(255,255,255,0.15); 
    transform: scale(1.08);
  }
  .nav-item.active { background: rgba(255,255,255,0.20); color: #fff; font-weight: 500; }

  .nav-item:hover .nav-icon { transform: scale(1.1); }

  .nav-label {
    opacity: 0;
    transform: translateX(-8px);
    transition: opacity 0.28s ease, transform 0.28s ease;
    white-space: nowrap;
    margin-left: 12px;
  }
  .sidebar.expanded .nav-label { opacity: 1; transform: translateX(0); }

  /* Scrollbar */
  .sidebar-inner::-webkit-scrollbar { width: 4px; }
  .sidebar-inner::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.18); border-radius: 2px; }
</style>